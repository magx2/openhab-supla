@startuml
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60
hide empty members

' Keep the most-shared abstractions visually at the top
top to bottom direction

skinparam class {
BackgroundColor<<OpenHAB>> HoneyDew
BackgroundColor<<SuplaCloud>> Cornsilk
BackgroundColor<<SuplaServer>> MistyRose
BackgroundColor<<SuplaCommon>> GreenYellow
}

' Anchor heavily used OpenHAB and Supla abstractions on the top rank
interface ThingHandler <<OpenHAB>>
interface BridgeHandler <<OpenHAB>>
abstract class BaseThingHandler <<OpenHAB>>
abstract class BaseBridgeHandler <<OpenHAB>>

abstract class AbstractDeviceHandler <<SuplaCommon>>
abstract class ServerAbstractDeviceHandler <<SuplaCommon>>

interface HandleCommand <<SuplaServer>>
interface HandleProto <<SuplaServer>>
interface SuplaDevice <<SuplaServer>>
interface SuplaThing <<SuplaServer>>
interface SuplaThingRegistry <<SuplaServer>>
interface SuplaBridge <<SuplaServer>>

class GatewayDeviceHandler <<SuplaServer>>
class SingleDeviceHandler <<SuplaServer>>
class SubDeviceHandler <<SuplaServer>>
class ServerBridgeHandler <<SuplaServer>>

class CloudBridgeHandler <<SuplaCloud>>
class CloudDeviceHandler <<SuplaCloud>>

' OpenHAB core relationships
ThingHandler <|.. BaseThingHandler
ThingHandler <|.. BridgeHandler
BridgeHandler <|.. BaseBridgeHandler

' Device handler relationships
BaseThingHandler <|-down- AbstractDeviceHandler
AbstractDeviceHandler <|-down- ServerAbstractDeviceHandler
AbstractDeviceHandler <|-down- SubDeviceHandler
AbstractDeviceHandler <|-down- CloudDeviceHandler
ServerAbstractDeviceHandler <|-down- GatewayDeviceHandler
ServerAbstractDeviceHandler <|-down- SingleDeviceHandler

' Supla trait implementations (device side)
HandleCommand <|.. AbstractDeviceHandler
HandleCommand <|.. SubDeviceHandler
HandleCommand <|.. SingleDeviceHandler
HandleProto <|.. ServerAbstractDeviceHandler
HandleProto <|.. SingleDeviceHandler
HandleProto <|.. GatewayDeviceHandler
HandleCommand <|-- SuplaDevice
HandleProto <|-- SuplaDevice
SuplaDevice <|.. SubDeviceHandler
SuplaDevice <|.. SingleDeviceHandler
SuplaDevice <|.. GatewayDeviceHandler
SuplaThing <|.. ServerAbstractDeviceHandler

' Bridge handler relationships
BaseBridgeHandler <|-down- CloudBridgeHandler
BaseBridgeHandler <|-down- ServerBridgeHandler
BridgeHandler <|.. SuplaBridge
SuplaBridge <|.. GatewayDeviceHandler
SuplaBridge <|.up. ServerBridgeHandler
SuplaThingRegistry <|.up. ServerBridgeHandler
@enduml
