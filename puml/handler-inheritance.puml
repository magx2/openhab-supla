@startuml
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60
hide empty members

' Keep the most-shared abstractions visually at the top
top to bottom direction

skinparam class {
  BackgroundColor<<OpenHAB>> HoneyDew
  BackgroundColor<<Supla>> Cornsilk
}

' Anchor heavily used OpenHAB and Supla abstractions on the top rank
package "OpenHAB Core" {
  interface ThingHandler <<OpenHAB>>
  interface BridgeHandler <<OpenHAB>>
  abstract class BaseThingHandler <<OpenHAB>>
  abstract class BaseBridgeHandler <<OpenHAB>>
}

package "Supla Traits" {
  interface HandleCommand <<Supla>>
  interface HandleProto <<Supla>>
  interface SuplaDevice <<Supla>>
  interface SuplaThing <<Supla>>
  interface SuplaThingRegistry <<Supla>>
  interface SuplaBridge <<Supla>>
}

package "Device handlers" {
  abstract class AbstractDeviceHandler <<Supla>>
  abstract class ServerAbstractDeviceHandler <<Supla>>
  class GatewayDeviceHandler <<Supla>>
  class SingleDeviceHandler <<Supla>>
  class SubDeviceHandler <<Supla>>
  class CloudDeviceHandler <<Supla>>
}

package "Bridge handlers" {
  class CloudBridgeHandler <<Supla>>
  class ServerBridgeHandler <<Supla>>
}

' OpenHAB core relationships
ThingHandler <|.down. BaseThingHandler
ThingHandler <|.down. BridgeHandler
BridgeHandler <|.down. BaseBridgeHandler

' Device handler relationships
BaseThingHandler <|-down- AbstractDeviceHandler
AbstractDeviceHandler <|-down- ServerAbstractDeviceHandler
AbstractDeviceHandler <|-down- SubDeviceHandler
AbstractDeviceHandler <|-down- CloudDeviceHandler
ServerAbstractDeviceHandler <|-down- GatewayDeviceHandler
ServerAbstractDeviceHandler <|-down- SingleDeviceHandler

' Supla trait implementations (device side)
HandleCommand <|.down. AbstractDeviceHandler
HandleCommand <|.down. SubDeviceHandler
HandleCommand <|.down. SingleDeviceHandler
HandleCommand <|.down. GatewayDeviceHandler
HandleProto <|.down. ServerAbstractDeviceHandler
HandleProto <|.down. SingleDeviceHandler
HandleProto <|.down. GatewayDeviceHandler
HandleCommand <|-down- SuplaDevice
HandleProto <|-down- SuplaDevice
SuplaDevice <|.down. SubDeviceHandler
SuplaDevice <|.down. SingleDeviceHandler
SuplaDevice <|.down. GatewayDeviceHandler
SuplaThing <|.down. ServerAbstractDeviceHandler

' Bridge handler relationships
BaseBridgeHandler <|-down- CloudBridgeHandler
BaseBridgeHandler <|-down- ServerBridgeHandler
BridgeHandler <|.down. SuplaBridge
SuplaBridge <|.down. GatewayDeviceHandler
SuplaBridge <|.down. ServerBridgeHandler
SuplaThingRegistry <|.down. ServerBridgeHandler
@enduml
