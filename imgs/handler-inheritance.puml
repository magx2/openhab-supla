@startuml
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60
hide empty members

' Keep the most-shared abstractions visually at the top
top to bottom direction

skinparam class {
  BackgroundColor<<OpenHAB>> HoneyDew
  BackgroundColor<<Supla>> Cornsilk
}

' Anchor heavily used OpenHAB and Supla abstractions on the top rank
rectangle "Shared abstractions" as Shared {
  together {
    package "OpenHAB Core" {
      interface ThingHandler <<OpenHAB>>
      interface BridgeHandler <<OpenHAB>>
      abstract class BaseThingHandler <<OpenHAB>>
      abstract class BaseBridgeHandler <<OpenHAB>>
    }

    package "Supla Traits" {
      interface HandleCommand <<Supla>>
      interface HandleProto <<Supla>>
      interface SuplaDevice <<Supla>>
      interface SuplaThing <<Supla>>
      interface SuplaThingRegistry <<Supla>>
      interface SuplaBridge <<Supla>>
    }
  }
}

package "Device handlers" {
  abstract class AbstractDeviceHandler <<Supla>>
  abstract class ServerAbstractDeviceHandler <<Supla>>
  class GatewayDeviceHandler <<Supla>>
  class SingleDeviceHandler <<Supla>>
  class SubDeviceHandler <<Supla>>
  class CloudDeviceHandler <<Supla>>
}

package "Bridge handlers" {
  class CloudBridgeHandler <<Supla>>
  class ServerBridgeHandler <<Supla>>
}

' OpenHAB core relationships
ThingHandler <|.. BaseThingHandler
ThingHandler <|.. BridgeHandler
BridgeHandler <|.. BaseBridgeHandler

' Device handler relationships
BaseThingHandler <|-- AbstractDeviceHandler
AbstractDeviceHandler <|-- ServerAbstractDeviceHandler
AbstractDeviceHandler <|-- SubDeviceHandler
AbstractDeviceHandler <|-- CloudDeviceHandler
ServerAbstractDeviceHandler <|-- GatewayDeviceHandler
ServerAbstractDeviceHandler <|-- SingleDeviceHandler

' Supla trait implementations (device side)
HandleCommand <|.. AbstractDeviceHandler
HandleCommand <|.. SubDeviceHandler
HandleCommand <|.. SingleDeviceHandler
HandleCommand <|.. GatewayDeviceHandler
HandleProto <|.. ServerAbstractDeviceHandler
HandleProto <|.. SingleDeviceHandler
HandleProto <|.. GatewayDeviceHandler
HandleCommand <|-- SuplaDevice
HandleProto <|-- SuplaDevice
SuplaDevice <|.. SubDeviceHandler
SuplaDevice <|.. SingleDeviceHandler
SuplaDevice <|.. GatewayDeviceHandler
SuplaThing <|.. ServerAbstractDeviceHandler

' Bridge handler relationships
BaseBridgeHandler <|-- CloudBridgeHandler
BaseBridgeHandler <|-- ServerBridgeHandler
BridgeHandler <|.. SuplaBridge
SuplaBridge <|.. GatewayDeviceHandler
SuplaBridge <|.. ServerBridgeHandler
SuplaThingRegistry <|.. ServerBridgeHandler
@enduml
